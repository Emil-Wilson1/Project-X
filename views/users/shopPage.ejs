<%- include('../layouts/headerUser.ejs') %>

<style>
    .cart-icon {
  position: relative;
  display: inline-block;
  align-items: center;
}

.icon_bag_alt {
  /* Your icon styles here */
  /* For example: */
  font-size: 24px;
  color: black;
}

.checkbox-item {
    display: flex;
    align-items: center;
    margin-bottom: 5px; /* Adjust margin as needed */
}


.cart-counter {
  position: absolute;
  bottom: 10px;
  right: -8px;
  background-color: red;
  color: white;
  border-radius: 50%;
  padding: 5px;
  width: 20px; /* Set the width and height to create a circle */
  height: 20px; /* Same as width for a perfect circle */
  text-align: center;
  font-size: 12px;
  font-weight: bold;
  line-height: 20px; /* Center the text vertically */
  display: flex;
  justify-content: center;
  align-items: center;
}

</style>


    

<div class="offcanvas-menu-overlay"></div>
<div class="offcanvas-menu-wrapper">
    <div class="offcanvas__close">+</div>
    <ul class="offcanvas__widget">
        <li><a href="#"><span class="icon_heart_alt"></span>
           
        </a></li>
 
            
        
    </ul>
    <!-- <div class="offcanvas__logo">
        <a href="/"></a>
    </div> -->
    <div id="mobile-menu-wrap"></div>
    <div class="offcanvas__auth">
        <% if(session!=null){
            %>
           <a class="dropdown-item" href="/logout">Logout</a>
           <% }else{%>
               <a class="dropdown-item" href="/login">Login</a>
               <a class="dropdown-item" href="/signup">Signup</a>
               <%}%>
    </div>
</div>



<!-- //////////////////////////////////// -->
    <header class="header">
        <div class="container-fluid">
            <div class="row justify-content-center align-items-center">
                <div class="col-lg-4 col-md-4">
                    <div class="header__logo" >
                        <a href="/" class="text-decoration-none">
                            <span class="text-1000 text-dark fs-1 mt-3 fw-bold ms-2">FINITO</span></a>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4">
                    <nav class="header__menu row ">
                        <div class="col-2 ">
                            <a class="" href="/">Home</a>
                        </div>
                        <div class="col-2">
                            <a class="text-danger active" href="/shopPage">Shop</a>
                        </div>
                        <div class="col-2">
                            <a href="/userProfile">Profile</a>
                        </div>
                    </nav>
                </div>
                <div class="col-lg-4 col-md-4 ">
                    <div class="header__right row ">
                       
                        <div class="header__right__auth col">
                            <div class="btn-group">
                                <ul class="header__right__widget mt-2 mr-3">
                                    
                                    <li><a href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Wishlist"><span class="icon_heart_alt"></span></a></li>
                                    <% if(session==null){%>
                                        <li><a href="/cart" data-bs-toggle="tooltip" data-bs-placement="top" title="Cart"><span class="icon_bag_alt"></span></a></li>
                                        <% }else{%>
                                        <div class="cart-icon">
                                            <a href="/cart">
                                              <span class="icon_bag_alt"></span>
                                              <span class="cart-counter"><%= counter%></span>
                                            </a>
                                          </div>
                                          <%}%>
                                </ul>
                                <button class="btn dropdown-toggle" type="button" id="dropdownMenuButton1"
                                    data-bs-toggle="dropdown"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                                        height="24" viewBox="0 0 24 24">
                                        <g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd">
                                            <path
                                                d="M16 9a4 4 0 1 1-8 0a4 4 0 0 1 8 0Zm-2 0a2 2 0 1 1-4 0a2 2 0 0 1 4 0Z" />
                                            <path
                                                d="M12 1C5.925 1 1 5.925 1 12s4.925 11 11 11s11-4.925 11-11S18.075 1 12 1ZM3 12c0 2.09.713 4.014 1.908 5.542A8.986 8.986 0 0 1 12.065 14a8.984 8.984 0 0 1 7.092 3.458A9 9 0 1 0 3 12Zm9 9a8.963 8.963 0 0 1-5.672-2.012A6.992 6.992 0 0 1 12.065 16a6.991 6.991 0 0 1 5.689 2.92A8.964 8.964 0 0 1 12 21Z" />
                                        </g>
                                    </svg>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                    <% if(session!=null){
                                         %>
                                        <li><a class="dropdown-item" href="/logout">Logout</a></li>
                                        <% }else{%>
                                            <li><a class="dropdown-item" href="/login">Login</a></li>
                                            <li><a class="dropdown-item" href="/signup">Signup</a></li>
                                            <%}%>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="canvas__open">
                <i class="fa fa-bars"></i>
            </div>
        </div>
    </header>


    <section class="shop spad">
        
        <div class="container">
            
            
            <div class="input-group d-flex justify-content-end mb-5">
  <div class="form-outline">
    <input onkeyup="filtersearch()" id="search" type="text" placeholder="Search..." class="form-control text-dark" />
  </div>
  <button type="button" style="border-color: #000;" class="btn btn-light btn-lg ">
    <i class="fa fa-search"></i>
  </button>
</div>

            <div class="row">
                <div class="col-lg-3 col-md-3">
                    <div class="shop__sidebar">
                        <div class="row">
                            <div class="sidebar__sizes col-lg-12 col-md-12 col-sm-6 col-6">
                            <div class="section-title">
                                <h4>Categories</h4>
                            </div>
                            <%category.forEach(element => {%>
                            <div class="checkbox-item">
                                <label for="">
                                    <%=element.category%>
                                    <input type="checkbox" onclick="category('<%=element.category%>')" name="<%=element.category%>" id="<%=element.category%>" value="<%=element.category%>">
                                    
                                </label>   
                            </div>
                            <%})%>
                        </div>
                        <div class="sidebar__sizes col-lg-12 col-md-12 col-sm-6 col-6">
                            <div class="section-title">
                                <h4>Shop by price</h4>
                            </div>
                            <div class="">
                                <label for="">
                                    5000-above
                                    <input  onclick="price(4)" type="checkbox" value="5000" id="FOUR">
                                </label><br>
                                <label for="">
                                    2000-4999
                                    <input  onclick="price(3)" type="checkbox" value="2000,4999" id="THREE">
                                </label><br>
                                <label for="">
                                    1000-1999
                                    <input onclick="price(2)" type="checkbox" value="1000,1999" id="TWO">
                                </label><br>
                                <label for="">
                                    0-999
                                    <input onclick="price(1)" type="checkbox" value="0,999" id="ONE">
                                </label><br>
                            </div>
                        </div>
                        </div>
                        
                       
                    </div>
                </div>
                <div class="col-lg-9 col-md-9">
                    <div id="Filter" class="row">
                        <%product.forEach(item => {%>
                            <div class="col-lg-4 col-md-6 col-sm-6">
                            <div class="product__item">
                                <div class="product__item__pic set-bg d-flex justify-content-center" data-setbg="">
                                    <a href="/singleProduct?id=<%=item._id%>"><img
                                            src="/proImage/<%=item.image[0]%>" alt=""></a>
                                            <%if(item.stocks<=0){%>
                                                <div class="label stockout">out of stock</div>
                                            <%}%>
                                    <ul class="product__hover">
                                        <li><a href="/proImage/<%=item.image[0]%>" class="image-popup"><span class="arrow_expand"></span></a></li>
                                        <li><a href="#"><span class="icon_heart_alt"></span></a></li>
                                        <li><a href="/addToCart?id=<%=item._id%>" id="addToCartButton"><span class="icon_bag_alt"></span></a></li>
                                    </ul>
                                </div>
                                <div class="product__item__text">
                                    <h6><a href="#"><%=item.title%></a></h6>
                                    <div class="rating">
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                    </div>
                                    <div class="product__price">₹ <%=item.price%></div>
                                </div>
                            </div>
                        </div>    
                        <%})%>
                        
                        
                        <div class="col-lg-12 text-center">
                            <div class="pagination__option">
                                <%for(let j=1;j<=totalPages;j++){%>
                                    <a href="?page=<%=j%>"><%=j%></a>
                        <%}%>
                                <a href=""><i class="fa fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    
    <%if(msg!=null){%>
      <script>
        new Swal({
          title: "Error",
          text: "<%=msg%>",
          icon: "error",
          showConfirmButton: false,
          timer: 2000
        });
      </script>
      <%}%>

      <%if(message!=null){%>
        <script>
          new Swal({
            title: "Success",
            text: "<%=message%>",
            icon: "success",
            showConfirmButton: false,
            timer: 2000
          });
        </script>
        <%}%>

<script>
    document.getElementById('addToCartButton').addEventListener('click', (event) => {
    // Prevent default behavior of anchor tag (prevents navigating to the href)
    event.preventDefault();

    // Get the href attribute of the anchor tag
    const href = event.currentTarget.getAttribute('href');

    // Perform the action (add to cart in this case)
    // You can perform any other action related to adding to the cart here

    // Reload the page after performing the action
    window.location.href = href;
});
</script>

<script>
    let n = 0
    let b = 0
    let categorys = []
    let search
    let prices=[]
    let filterprice=[]
function category(ID) {


if ($(`#${ID}`).is(':checked') == true) {
categorys[n] = $(`#${ID}`).val()
n++
} else {
let index = categorys.indexOf(`${$(`#${ID}`).val()}`)
categorys.splice(index, 1)
n--
}
submit(categorys,filterprice,search)

}


function submit(categorys) {
                                $.ajax({
                                    url: '/shopFilter',
                                    type: 'post',
                                    dataType: 'json',
                                    contentType: 'application/json',
                                    data: JSON.stringify({ categorys,filterprice,search}),
                                    success: (res) => {
                                        let html = []
                                        if (res.Data) {
                                            $('#Filter').html('')
                                            res.Data.forEach(value => {
                                                value.forEach((item, i) => {
                                                    html += `<div class="col-lg-4 col-md-6">
                        <div class="product__item">
                            <div class="product__item__pic set-bg" data-setbg="">
                                <a href="/singleProduct?id=${item._id}"><img
                                        src="/proImage/${item.image[0].toString('utf8')}" alt=""></a>
                                        
                                <ul class="product__hover">
                                    <li><a href="/proImage/${item.image[0].toString('utf8')}" class="image-popup"><span class="arrow_expand"></span></a></li>
                                    <li><a href="/addToWishlist?id=${item._id}"><span class="icon_heart_alt"></span></a></li>
                                    <li><a href="/addToCart?id=${item._id}"><span class="icon_bag_alt"></span></a></li>
                                </ul>
                            </div>
                            <div class="product__item__text">
                                <h6><a href="#">${item.title}</a></h6>
                                <div class="rating">
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                </div>
                                <div class="product__price">₹ ${item.price}</div>
                            </div>
                        </div>
                    </div> `

                                                })

                                            });

                                            $('#Filter').html(html)




                                        }
                                    }
                                })
                            }

                            function filtersearch() {
                                search = $('#search').val()
                                submit(categorys, search,filterprice)
                            }


                            function price(check){
                                filterprice=[]
                                let one,two,three,fore
                                let n=0,index
                                if($("#ONE").is(':checked')==true){
                                 one=$("#ONE").val()
                                 prices[n]=one
                                 n++
                                }else if(check==1){
                                    index=prices.indexOf($("#ONE").val())
                                    prices.splice(index,1)
                                    
                                }
                                if($("#TWO").is(':checked')==true){
                                    two=$("#TWO").val()
                                    prices[n]=two
                                    n++
                                }else if(check==2){
                                    index=prices.indexOf($("#TWO").val())
                                    prices.splice(index,1)
                                    
                                }
                                if($("#THREE").is(':checked')==true){
                                    three=$("#THREE").val()
                                    prices[n]=three
                                    n++
                                }else if(check==3){
                                    index=prices.indexOf($("#THREE").val())
                                    prices.splice(index,1)
                                
                                }
                                if($("#FOUR").is(':checked')==true){
                                    fore=$("#FOUR").val()
                                    prices[n]=fore
                                    n++
                                }else if(check==4){
                                    index=prices.indexOf($("#FOUR").val())
                                    prices.splice(index,1)
                                    
                                }
                                let length
                                if (prices) {
                                     length=prices.length
                                }
                               
                                if(prices.length==1&&prices[length-1].split(',').length==2){
                                    let first=[prices[length-1]]
                                    first=first[0].split(',')
    
                                    filterprice[0]=first[0]
                                    filterprice[1]=first[1]
                                    
                                }else if(prices.length==1&&prices[length-1].split(',').length==1){
                                    let first=[]
                                     first[0]=prices[0]
                                   filterprice[0]=first[0]
                                }else if(prices.length>1&&prices[length-1].split(',').length==2) {
                                    let first=[prices[0]]
                                    let second=[prices[length-1]]
                                first=first[0].split(',')
                                second=second[0].split(',')
                                filterprice[0]=first[0]
                                filterprice[1]=second[1]
                                }else if(prices.length>1&&prices[length-1].split(',').length==1){
                                    let first=[prices[0]]
                                first=first[0].split(',')
                                filterprice[0]=first[0]
                                }
                                submit(categorys,search,filterprice)
                            }

</script>

<%- include('../layouts/pagesFooter.ejs') %>